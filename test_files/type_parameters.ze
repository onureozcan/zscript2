var generic_fnc = fun<T:Any> (arg:T) : T {
    var ret: T = arg
    return arg
}

var int_test: int = generic_fnc(3)
var string_test: String = generic_fnc("test")

print(int_test)
print(string_test)

var int_test_explicit_args: int = generic_fnc<int>(3)
var string_test_explicit_args: String = generic_fnc<String>("test")

print(int_test_explicit_args)
print(string_test_explicit_args)

var second_order_generic_fnc = fun<T> (arg:T) : fun<String,T> {

    return fun(str: String): T {
        print("I am a function generated by a high order generic function.
            you give me a string : `" + str + "` and i give you an object of type T!")
        var result: T = arg
        return result
    }
}

var generated_fnc_decimal: fun<String,decimal> = second_order_generic_fnc(3.14)
var generated_fnc_string: fun<String,String> = second_order_generic_fnc("osman")
var generated_fnc_int: fun<String,int> = second_order_generic_fnc(-5)

print(generated_fnc_decimal("test - decimal"))
print(generated_fnc_string("test - string"))
print(generated_fnc_int("test - int"))

var bounded_type_parametric_fnc = fun <T:int> (num:T):T {
    print("* operation only defined on numbers.
    T is bounded to int (i know it is silly but just to test) so * should be legal on T as well")
    var ret:T = num * 2
    return ret
}
print(bounded_type_parametric_fnc(3))

print("type parameters are allowed to be parametric as well")

var parametric_type_parameter_test_explicit_test = generic_fnc<fun<int,int>>(
    fun (i:int):int {
        return i + 10
    }
)
print(parametric_type_parameter_test_explicit_test(5))

var parametric_type_parameter_test_implicit_test = generic_fnc(
    fun (i:int):int {
        return i + 10
    }
)
print(parametric_type_parameter_test_implicit_test(5))

print("parametric functions can have parametric functions as children")

var generic_fnc_2 = fun <T> (t: T): T {

    var inner_generic_fnc = fun <P> (p: P): P {
          return p
    }

    return inner_generic_fnc<T>(t)
}


var inner_generic_fnc_string_test: String = generic_fnc_2("test")
var inner_generic_fnc_fnc_test: fun<String> = generic_fnc_2(fun():String{
    return "fnc"
})

print(inner_generic_fnc_string_test)
print(inner_generic_fnc_fnc_test())
